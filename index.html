<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>D·ª± B√°o Th·ªùi Ti·∫øt Pro - Phi√™n B·∫£n Ti·∫øng Vi·ªát</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    body {
      font-family: 'Inter', sans-serif;
    }
    
    /* Custom animations */
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes glow {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }
    
    .animate-float {
      animation: float 3s ease-in-out infinite;
    }
    
    .animate-glow {
      animation: glow 2s ease-in-out infinite;
    }
    
    /* Glass morphism effect */
    .glass {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    /* Custom scrollbar for suggestions */
    #citySuggestions::-webkit-scrollbar {
      width: 4px;
    }
    
    #citySuggestions::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
    }
    
    #citySuggestions::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 4px;
    }
    
    #citySuggestions::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.5);
    }
    
    /* Loading animation */
    .loading-spinner {
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 2px solid white;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 text-white relative overflow-hidden">
  <!-- Animated background elements -->
  <div class="absolute inset-0 overflow-hidden">
    <div class="absolute -top-40 -right-40 w-80 h-80 bg-blue-400 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse"></div>
    <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-purple-400 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse delay-1000"></div>
    <div class="absolute top-40 left-1/2 w-80 h-80 bg-pink-400 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse delay-500"></div>
  </div>
  
  <div class="relative z-10 bg-white/10 backdrop-blur-2xl rounded-3xl shadow-2xl p-8 max-w-md w-full border border-white/20 hover:shadow-3xl transition-all duration-500">
    <h1 class="text-3xl font-bold mb-8 text-center bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent animate-pulse">
      ‚õÖ D·ª± B√°o Th·ªùi Ti·∫øt Pro
    </h1>
    
    <!-- Search by city name -->
    <div class="relative mb-6">
      <div class="flex gap-3">
        <div class="relative flex-1">
          <input id="cityInput" type="text" placeholder="üîç T√¨m ki·∫øm th√†nh ph·ªë..." 
                 class="w-full p-4 rounded-2xl bg-white/20 border-2 border-white/30 focus:outline-none focus:border-blue-400 focus:bg-white/30 transition-all duration-300 text-white placeholder-white/70 backdrop-blur-xl shadow-lg" 
                 autocomplete="off" />
          <div class="absolute inset-0 rounded-2xl bg-gradient-to-r from-blue-500/20 to-purple-500/20 pointer-events-none opacity-0 transition-opacity duration-300" id="inputGlow"></div>
        </div>
        <button id="searchBtn" class="px-6 py-4 rounded-2xl bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold hover:from-blue-600 hover:to-purple-700 active:scale-95 transform transition-all duration-200 shadow-lg hover:shadow-xl">
          <span class="hidden sm:inline">T√¨m ki·∫øm</span>
          <span class="sm:hidden">üîç</span>
        </button>
        <button id="locationBtn" class="px-4 py-4 rounded-2xl bg-gradient-to-r from-green-500 to-teal-600 text-white font-semibold hover:from-green-600 hover:to-teal-700 active:scale-95 transform transition-all duration-200 shadow-lg hover:shadow-xl" title="S·ª≠ d·ª•ng v·ªã tr√≠ hi·ªán t·∫°i">
          üìç
        </button>
      </div>
      <!-- City suggestions dropdown -->
      <div id="citySuggestions" class="absolute top-full left-0 right-0 bg-white/15 backdrop-blur-xl border border-white/30 rounded-2xl shadow-2xl mt-2 max-h-60 overflow-y-auto z-50 hidden">
      </div>
    </div>
    
    <!-- Loading indicator -->
    <div id="loadingIndicator" class="hidden text-center py-4">
      <div class="loading-spinner mx-auto mb-2"></div>
      <p class="text-white/80">üå§Ô∏è ƒêang t·∫£i d·ªØ li·ªáu th·ªùi ti·∫øt...</p>
    </div>
    
    <!-- Weather card -->
    <div id="weatherCard" class="hidden">
      <div class="bg-gradient-to-br from-blue-500/30 to-purple-600/30 backdrop-blur-xl rounded-3xl p-6 border border-white/30 shadow-2xl hover:shadow-3xl transition-all duration-500 transform hover:scale-[1.02]">
        <div class="flex flex-col items-center gap-4">
          <div class="relative">
            <img id="weatherIcon" alt="bi·ªÉu t∆∞·ª£ng th·ªùi ti·∫øt" class="w-28 h-28 drop-shadow-2xl animate-bounce" />
            <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/20 to-orange-500/20 rounded-full blur-xl"></div>
          </div>
          
          <div class="text-center">
            <h2 id="location" class="text-2xl font-bold text-white mb-2 drop-shadow-lg"></h2>
            <p id="description" class="capitalize text-white/90 font-medium text-lg mb-4"></p>
          </div>
          
          <div class="text-center">
            <div class="text-6xl font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent drop-shadow-lg mb-2">
              <span id="temp"></span><span class="text-4xl">¬∞C</span>
            </div>
            <div class="text-lg text-white/80 font-medium">
              C·∫£m gi√°c nh∆∞: <span id="feelsLike" class="font-bold"></span>¬∞C
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-4 w-full">
            <div class="flex flex-col items-center p-3 bg-white/20 rounded-2xl backdrop-blur-sm border border-white/30">
              <div class="text-2xl mb-1">üíß</div>
              <div class="text-sm text-white/80">ƒê·ªô ·∫®m</div>
              <div class="font-bold text-white"><span id="humidity"></span>%</div>
            </div>
            <div class="flex flex-col items-center p-3 bg-white/20 rounded-2xl backdrop-blur-sm border border-white/30">
              <div class="text-2xl mb-1">üí®</div>
              <div class="text-sm text-white/80">Gi√≥</div>
              <div class="font-bold text-white"><span id="wind"></span> m/s</div>
            </div>
            <div class="flex flex-col items-center p-3 bg-white/20 rounded-2xl backdrop-blur-sm border border-white/30">
              <div class="text-2xl mb-1">üëÅÔ∏è</div>
              <div class="text-sm text-white/80">T·∫ßm Nh√¨n</div>
              <div class="font-bold text-white"><span id="visibility"></span> km</div>
            </div>
            <div class="flex flex-col items-center p-3 bg-white/20 rounded-2xl backdrop-blur-sm border border-white/30">
              <div class="text-2xl mb-1">üå°Ô∏è</div>
              <div class="text-sm text-white/80">√Åp Su·∫•t</div>
              <div class="font-bold text-white"><span id="pressure"></span> hPa</div>
            </div>
          </div>
          
          <div class="w-full bg-white/20 rounded-2xl p-4 backdrop-blur-sm border border-white/30">
            <div class="flex justify-between items-center mb-2">
              <span class="text-white/80">üåÖ M·∫∑t tr·ªùi m·ªçc:</span>
              <span class="font-bold text-white" id="sunrise"></span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-white/80">üåá M·∫∑t tr·ªùi l·∫∑n:</span>
              <span class="font-bold text-white" id="sunset"></span>
            </div>
          </div>
          
          <p id="lastUpdate" class="text-xs text-white/70 mt-4 font-medium"></p>
        </div>
      </div>
    </div>

    <div id="errorMsg" class="text-red-300 text-center mt-6 p-4 bg-red-500/20 rounded-2xl border border-red-400/30 backdrop-blur-xl hidden"></div>
    
    <!-- Debug info -->
    <div id="debugInfo" class="mt-4 p-3 bg-gray-800/50 rounded-lg text-xs text-gray-300 hidden">
      <div>T√™n ƒë√£ ch·ªçn: <span id="debugSelected"></span></div>
      <div>T√™n t·ª´ API: <span id="debugAPI"></span></div>
    </div>
    
    <p class="text-sm text-center mb-6 text-white/80">‚ú® Th·ª≠ nh·∫≠p: Nha Trang, ƒê√† N·∫µng, H·ªì Ch√≠ Minh... ho·∫∑c cho ph√©p truy c·∫≠p v·ªã tr√≠</p>
  </div>

  <script>
    // ======= C·∫§U H√åNH =======
    const apiKey = "30356bf69782483aa1c37becfb682168"; // API key c·ªßa b·∫°n
    // =======================

    // B·∫£ng d·ªãch m√¥ t·∫£ th·ªùi ti·∫øt t·ª´ ti·∫øng Anh sang ti·∫øng Vi·ªát
    const weatherDescriptions = {
      // Clear sky
      "clear sky": "tr·ªùi quang ƒë√£ng",
      "clear": "quang ƒë√£ng",
      
      // Clouds
      "few clouds": "√≠t m√¢y",
      "scattered clouds": "m√¢y r·∫£i r√°c",
      "broken clouds": "m√¢y c·ª•m",
      "overcast clouds": "m√¢y che ph·ªß",
      "partly cloudy": "c√≥ m√¢y",
      "mostly cloudy": "nhi·ªÅu m√¢y",
      "cloudy": "m√¢y",
      
      // Rain
      "light rain": "m∆∞a nh·∫π",
      "moderate rain": "m∆∞a v·ª´a",
      "heavy intensity rain": "m∆∞a to",
      "very heavy rain": "m∆∞a r·∫•t to",
      "extreme rain": "m∆∞a c·ª±c to",
      "freezing rain": "m∆∞a ƒë√° nh·ªè",
      "light intensity shower rain": "m∆∞a r√†o nh·∫π",
      "shower rain": "m∆∞a r√†o",
      "heavy intensity shower rain": "m∆∞a r√†o to",
      "ragged shower rain": "m∆∞a r√†o kh√¥ng ƒë·ªÅu",
      "rain": "m∆∞a",
      "drizzle": "m∆∞a ph√πn",
      "heavy shower rain and drizzle": "m∆∞a r√†o to v√† m∆∞a ph√πn",
      "shower drizzle": "m∆∞a ph√πn r√†o",
      
      // Thunderstorm
      "thunderstorm with light rain": "d√¥ng v·ªõi m∆∞a nh·∫π",
      "thunderstorm with rain": "d√¥ng c√≥ m∆∞a",
      "thunderstorm with heavy rain": "d√¥ng c√≥ m∆∞a to",
      "light thunderstorm": "d√¥ng nh·∫π",
      "thunderstorm": "d√¥ng",
      "heavy thunderstorm": "d√¥ng m·∫°nh",
      "ragged thunderstorm": "d√¥ng kh√¥ng ƒë·ªÅu",
      "thunderstorm with light drizzle": "d√¥ng v·ªõi m∆∞a ph√πn nh·∫π",
      "thunderstorm with drizzle": "d√¥ng v·ªõi m∆∞a ph√πn",
      "thunderstorm with heavy drizzle": "d√¥ng v·ªõi m∆∞a ph√πn to",
      
      // Snow
      "light snow": "tuy·∫øt nh·∫π",
      "snow": "tuy·∫øt",
      "heavy snow": "tuy·∫øt to",
      "sleet": "m∆∞a tuy·∫øt",
      "light shower sleet": "m∆∞a tuy·∫øt nh·∫π",
      "shower sleet": "m∆∞a tuy·∫øt r√†o",
      "light rain and snow": "m∆∞a nh·∫π v√† tuy·∫øt",
      "rain and snow": "m∆∞a v√† tuy·∫øt",
      "light shower snow": "tuy·∫øt r√†o nh·∫π",
      "shower snow": "tuy·∫øt r√†o",
      "heavy shower snow": "tuy·∫øt r√†o to",
      
      // Atmosphere
      "mist": "s∆∞∆°ng m√π",
      "smoke": "kh√≥i",
      "haze": "s∆∞∆°ng kh√¥",
      "sand/dust whirls": "c√°t/b·ª•i xo√°y",
      "fog": "s∆∞∆°ng ƒë·∫∑c",
      "sand": "c√°t",
      "dust": "b·ª•i",
      "volcanic ash": "tro n√∫i l·ª≠a",
      "squalls": "gi√≥ gi·∫≠t",
      "tornado": "l·ªëc xo√°y"
    };

    // C√°c ph·∫ßn t·ª≠ DOM
    const weatherCard = document.getElementById("weatherCard");
    const cityInput = document.getElementById("cityInput");
    const searchBtn = document.getElementById("searchBtn");
    const locationBtn = document.getElementById("locationBtn");
    const errorMsg = document.getElementById("errorMsg");
    const citySuggestions = document.getElementById("citySuggestions");
    const loadingIndicator = document.getElementById("loadingIndicator");

    const iconEl = document.getElementById("weatherIcon");
    const locEl = document.getElementById("location");
    const descEl = document.getElementById("description");
    const tempEl = document.getElementById("temp");
    const feelsLikeEl = document.getElementById("feelsLike");
    const humidityEl = document.getElementById("humidity");
    const windEl = document.getElementById("wind");
    const visibilityEl = document.getElementById("visibility");
    const pressureEl = document.getElementById("pressure");
    const sunriseEl = document.getElementById("sunrise");
    const sunsetEl = document.getElementById("sunset");
    const lastUpdEl = document.getElementById("lastUpdate");

    // Debug elements
    const debugInfo = document.getElementById("debugInfo");
    const debugSelected = document.getElementById("debugSelected");
    const debugAPI = document.getElementById("debugAPI");

    let currentLat = null,
        currentLon = null,
        debounceTimer = null,
        selectedCityName = null; // L∆∞u t√™n th√†nh ph·ªë ng∆∞·ªùi d√πng ch·ªçn

    // B·∫≠t ch·∫ø ƒë·ªô debug b·∫±ng c√°ch th√™m ?debug=1 v√†o URL
    const isDebugMode = new URLSearchParams(window.location.search).get('debug') === '1';
    if (isDebugMode) {
      debugInfo.classList.remove('hidden');
    }

    // Hi·ªÉn th·ªã/·∫©n loading
    function showLoading() {
      loadingIndicator.classList.remove('hidden');
      weatherCard.classList.add('hidden');
      errorMsg.classList.add('hidden');
    }

    function hideLoading() {
      loadingIndicator.classList.add('hidden');
    }

    // D·ªãch m√¥ t·∫£ th·ªùi ti·∫øt sang ti·∫øng Vi·ªát
    function translateWeatherDescription(description) {
      const lowercaseDesc = description.toLowerCase();
      return weatherDescriptions[lowercaseDesc] || description;
    }

    // ƒê·ªãnh d·∫°ng th·ªùi gian
    function formatTime(timestamp) {
      return new Date(timestamp * 1000).toLocaleTimeString('vi-VN', {
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // L·∫•y d·ªØ li·ªáu th·ªùi ti·∫øt theo t·ªça ƒë·ªô
    async function fetchWeather(lat, lon) {
      try {
        showLoading();
        const r = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=vi`);
        if (!r.ok) {
          if (r.status === 401) {
            throw new Error("‚ùå API key kh√¥ng h·ª£p l·ªá. Vui l√≤ng ki·ªÉm tra l·∫°i API key OpenWeatherMap c·ªßa b·∫°n.");
          }
          throw new Error("üå§Ô∏è Kh√¥ng th·ªÉ l·∫•y d·ªØ li·ªáu th·ªùi ti·∫øt. Vui l√≤ng th·ª≠ l·∫°i sau.");
        }
        const data = await r.json();
        updateUI(data);
      } catch (err) {
        displayError(err.message);
      } finally {
        hideLoading();
      }
    }

    // L·∫•y d·ªØ li·ªáu th·ªùi ti·∫øt theo t√™n th√†nh ph·ªë
    async function fetchWeatherByCity(city) {
      try {
        showLoading();
        // ƒê·∫ßu ti√™n, s·ª≠ d·ª•ng geocoding ƒë·ªÉ t√¨m th√†nh ph·ªë v√† l·∫•y t·ªça ƒë·ªô ch√≠nh x√°c
        const geoResponse = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(city)}&limit=1&appid=${apiKey}`);
        
        if (!geoResponse.ok) {
          if (geoResponse.status === 401) {
            throw new Error("‚ùå API key kh√¥ng h·ª£p l·ªá. Vui l√≤ng ki·ªÉm tra l·∫°i API key OpenWeatherMap c·ªßa b·∫°n.");
          }
          throw new Error("üåê Kh√¥ng th·ªÉ t√¨m th·∫•y v·ªã tr√≠ th√†nh ph·ªë. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.");
        }
        
        const geoData = await geoResponse.json();
        if (geoData.length === 0) {
          throw new Error(`üèôÔ∏è Kh√¥ng t√¨m th·∫•y th√†nh ph·ªë "${city}". Vui l√≤ng ki·ªÉm tra ch√≠nh t·∫£ ho·∫∑c ch·ªçn t·ª´ g·ª£i √Ω.`);
        }
        
        const { lat, lon, name, country, state } = geoData[0];
        // L∆∞u t√™n th√†nh ph·ªë ch√≠nh x√°c t·ª´ d·ªØ li·ªáu geocoding
        selectedCityName = state ? `${name}, ${state}, ${country}` : `${name}, ${country}`;
        
        if (isDebugMode) {
          debugSelected.textContent = selectedCityName;
        }
        
        await fetchWeather(lat, lon);
      } catch (err) {
        displayError(err.message);
        hideLoading();
      }
    }

    // T√¨m ki·∫øm th√†nh ph·ªë s·ª≠ d·ª•ng OpenWeatherMap Geocoding API
    async function searchCities(query) {
      if (!query || query.length < 2) {
        citySuggestions.classList.add("hidden");
        return;
      }
      
      try {
        const response = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(query)}&limit=5&appid=${apiKey}`);
        
        if (!response.ok) {
          if (response.status === 401) {
            throw new Error("API key kh√¥ng h·ª£p l·ªá. Vui l√≤ng ki·ªÉm tra l·∫°i API key OpenWeatherMap c·ªßa b·∫°n.");
          }
          throw new Error("Kh√¥ng th·ªÉ t√¨m ki·∫øm th√†nh ph·ªë");
        }
        
        const cities = await response.json();
        displayCitySuggestions(cities);
      } catch (err) {
        console.error("L·ªói t√¨m ki·∫øm th√†nh ph·ªë:", err);
        citySuggestions.classList.add("hidden");
        if (err.message.includes("API key")) {
          displayError(err.message);
        }
      }
    }

    // Hi·ªÉn th·ªã g·ª£i √Ω th√†nh ph·ªë v·ªõi giao di·ªán c·∫£i ti·∫øn
    function displayCitySuggestions(cities) {
      citySuggestions.innerHTML = "";
      
      if (cities.length === 0) {
        citySuggestions.innerHTML = '<div class="p-4 text-white/70 text-sm text-center">üîç Kh√¥ng t√¨m th·∫•y th√†nh ph·ªë n√†o</div>';
        citySuggestions.classList.remove("hidden");
        return;
      }

      cities.forEach((city, index) => {
        const cityElement = document.createElement("div");
        cityElement.className = "p-4 hover:bg-white/20 cursor-pointer border-b border-white/20 last:border-b-0 transition-all duration-300 hover:backdrop-blur-xl group";
        
        const cityName = city.local_names && city.local_names.vi ? city.local_names.vi : 
                        (city.local_names && city.local_names.en ? city.local_names.en : city.name);
        const countryName = city.country;
        const stateName = city.state ? `, ${city.state}` : "";
        
        cityElement.innerHTML = `
          <div class="flex items-center justify-between">
            <div>
              <div class="font-semibold text-white group-hover:text-blue-300 transition-colors">${cityName}</div>
              <div class="text-sm text-white/70">üìç ${countryName}${stateName}</div>
            </div>
            <div class="text-xs text-white/50 bg-white/10 px-2 py-1 rounded-full">${index + 1}</div>
          </div>
        `;
        
        cityElement.addEventListener("click", () => {
          const displayName = stateName ? `${cityName}${stateName}, ${countryName}` : `${cityName}, ${countryName}`;
          cityInput.value = displayName;
          selectedCityName = displayName; // L∆∞u t√™n th√†nh ph·ªë ƒë√£ ch·ªçn
          
          if (isDebugMode) {
            debugSelected.textContent = selectedCityName;
          }
          
          citySuggestions.classList.add("hidden");
          fetchWeather(city.lat, city.lon);
        });
        
        citySuggestions.appendChild(cityElement);
      });
      
      citySuggestions.classList.remove("hidden");
    }

    // C·∫≠p nh·∫≠t giao di·ªán v·ªõi d·ªØ li·ªáu th·ªùi ti·∫øt
    function updateUI(d) {
      errorMsg.classList.add("hidden");
      weatherCard.classList.remove("hidden");
      
      iconEl.src = `https://openweathermap.org/img/wn/${d.weather[0].icon}@4x.png`;
      iconEl.alt = d.weather[0].description;
      
      // S·ª≠ d·ª•ng t√™n th√†nh ph·ªë ƒë√£ ch·ªçn n·∫øu c√≥, n·∫øu kh√¥ng th√¨ d√πng d·ªØ li·ªáu t·ª´ API
      const apiLocationName = `${d.name}, ${d.sys.country}`;
      if (selectedCityName) {
        locEl.textContent = selectedCityName;
      } else {
        locEl.textContent = apiLocationName;
      }
      
      if (isDebugMode) {
        debugAPI.textContent = apiLocationName;
      }
      
      // D·ªãch m√¥ t·∫£ th·ªùi ti·∫øt sang ti·∫øng Vi·ªát
      const translatedDescription = translateWeatherDescription(d.weather[0].description);
      descEl.textContent = translatedDescription;
      
      tempEl.textContent = Math.round(d.main.temp);
      feelsLikeEl.textContent = Math.round(d.main.feels_like);
      humidityEl.textContent = d.main.humidity;
      windEl.textContent = d.wind.speed;
      visibilityEl.textContent = d.visibility ? Math.round(d.visibility / 1000) : 'N/A';
      pressureEl.textContent = d.main.pressure;
      sunriseEl.textContent = formatTime(d.sys.sunrise);
      sunsetEl.textContent = formatTime(d.sys.sunset);
      lastUpdEl.textContent = `üïí C·∫≠p nh·∫≠t l√∫c: ${new Date().toLocaleTimeString('vi-VN')}`;

      currentLat = d.coord.lat;
      currentLon = d.coord.lon;
      
      // Th√™m hi·ªáu ·ª©ng m∆∞·ª£t khi c·∫≠p nh·∫≠t
      weatherCard.style.opacity = '0';
      setTimeout(() => {
        weatherCard.style.opacity = '1';
      }, 100);
    }

    // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
    function displayError(msg) {
      weatherCard.classList.add("hidden");
      errorMsg.textContent = msg;
      errorMsg.classList.remove("hidden");
      
      // T·ª± ƒë·ªông ·∫©n l·ªói sau 5 gi√¢y
      setTimeout(() => {
        errorMsg.classList.add("hidden");
      }, 5000);
    }

    // ·∫®n g·ª£i √Ω khi click b√™n ngo√†i
    document.addEventListener("click", (e) => {
      if (!e.target.closest("#cityInput") && !e.target.closest("#citySuggestions")) {
        citySuggestions.classList.add("hidden");
      }
    });

    // T·ª± ƒë·ªông c·∫≠p nh·∫≠t m·ªói 10 ph√∫t n·∫øu c√≥ t·ªça ƒë·ªô
    setInterval(() => {
      if (currentLat && currentLon) {
        fetchWeather(currentLat, currentLon);
      }
    }, 600_000); // 600k ms = 10 ph√∫t

    // Event listeners v·ªõi ch·ª©c nƒÉng c·∫£i ti·∫øn
    searchBtn.addEventListener("click", () => {
      const city = cityInput.value.trim();
      if (city) {
        citySuggestions.classList.add("hidden");
        fetchWeatherByCity(city);
      } else {
        displayError("üîç Vui l√≤ng nh·∫≠p t√™n th√†nh ph·ªë");
      }
    });

    locationBtn.addEventListener("click", () => {
      if (navigator.geolocation) {
        locationBtn.innerHTML = '<div class="loading-spinner"></div>';
        navigator.geolocation.getCurrentPosition(
          pos => {
            selectedCityName = null; // Reset t√™n th√†nh ph·ªë ƒë√£ ch·ªçn cho geolocation
            if (isDebugMode) {
              debugSelected.textContent = "ƒêang s·ª≠ d·ª•ng v·ªã tr√≠ hi·ªán t·∫°i";
            }
            fetchWeather(pos.coords.latitude, pos.coords.longitude);
            locationBtn.innerHTML = 'üìç';
          },
          err => {
            locationBtn.innerHTML = 'üìç';
            displayError("‚ùå Kh√¥ng th·ªÉ truy c·∫≠p v·ªã tr√≠ c·ªßa b·∫°n. Vui l√≤ng cho ph√©p truy c·∫≠p v·ªã tr√≠ ho·∫∑c t√¨m ki·∫øm th·ªß c√¥ng.");
          }
        );
      } else {
        displayError("‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã GPS");
      }
    });

    cityInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        citySuggestions.classList.add("hidden");
        searchBtn.click();
      }
    });

    // T√¨m ki·∫øm th√†nh ph·ªë th·ªùi gian th·ª±c v·ªõi debouncing (300ms)
    cityInput.addEventListener("input", (e) => {
      clearTimeout(debounceTimer);
      const query = e.target.value.trim();
      
      if (query.length < 2) {
        citySuggestions.classList.add("hidden");
        return;
      }
      
      debounceTimer = setTimeout(() => {
        searchCities(query);
      }, 300); // 300ms debounce
    });

    // Th√™m hi·ªáu ·ª©ng ph√°t s√°ng khi focus input
    cityInput.addEventListener("focus", () => {
      const inputGlow = document.getElementById("inputGlow");
      if (inputGlow) {
        inputGlow.style.opacity = "1";
      }
      const query = cityInput.value.trim();
      if (query.length >= 2) {
        searchCities(query);
      }
    });

    cityInput.addEventListener("blur", () => {
      const inputGlow = document.getElementById("inputGlow");
      if (inputGlow) {
        inputGlow.style.opacity = "0";
      }
    });

    // Th·ª≠ geolocation khi t·∫£i trang
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        pos => {
          selectedCityName = null; // Reset t√™n th√†nh ph·ªë ƒë√£ ch·ªçn cho geolocation
          if (isDebugMode) {
            debugSelected.textContent = "ƒêang s·ª≠ d·ª•ng v·ªã tr√≠ hi·ªán t·∫°i";
          }
          fetchWeather(pos.coords.latitude, pos.coords.longitude);
        },
        err => {
          console.warn("Quy·ªÅn truy c·∫≠p v·ªã tr√≠ b·ªã t·ª´ ch·ªëi ho·∫∑c kh√¥ng kh·∫£ d·ª•ng.");
        }
      );
    }
  </script>
</body>
</html>
